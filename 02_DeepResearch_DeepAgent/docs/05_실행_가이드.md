# ì‹¤í–‰ ê°€ì´ë“œ

## ğŸ“Œ ì‹œì‘í•˜ê¸° ì „ì—

ì´ ê°€ì´ë“œëŠ” DeepResearch DeepAgent ì‹œìŠ¤í…œì„ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ› ï¸ 1ë‹¨ê³„: í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

```bash
# Python ë²„ì „
Python 3.10 ì´ìƒ

# í•„ìˆ˜ íŒ¨í‚¤ì§€
- langchain
- langgraph
- deepagents
- tavily-python (ê²€ìƒ‰ìš©)
- python-dotenv
```

### ì„¤ì¹˜ ë°©ë²•

```bash
# 1. ì €ì¥ì†Œ í´ë¡  (ë˜ëŠ” í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™)
cd /path/to/02_DeepResearch_DeepAgent

# 2. ê°€ìƒí™˜ê²½ ìƒì„± (ê¶Œì¥)
python -m venv venv

# 3. ê°€ìƒí™˜ê²½ í™œì„±í™”
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate

# 4. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
# ë˜ëŠ” ê°œë³„ ì„¤ì¹˜:
pip install langchain langgraph deepagents tavily-python python-dotenv
```

---

## ğŸ”‘ 2ë‹¨ê³„: API í‚¤ ì„¤ì •

### .env íŒŒì¼ ìƒì„±

```bash
# .env.exampleì„ ë³µì‚¬í•˜ì—¬ .env ìƒì„±
cp .env.example .env
```

### API í‚¤ ì…ë ¥

`.env` íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì…ë ¥:

```bash
# Tavily ê²€ìƒ‰ API (í•„ìˆ˜)
TAVILY_API_KEY="tvly-your-api-key-here"

# OpenAI API (GPT ëª¨ë¸ ì‚¬ìš© ì‹œ)
OPENAI_API_KEY="sk-your-openai-key-here"

# Anthropic API (Claude ëª¨ë¸ ì‚¬ìš© ì‹œ)
ANTHROPIC_API_KEY="sk-ant-your-anthropic-key-here"

# ì‘ì—… ê³µê°„ ë£¨íŠ¸ (ì„ íƒ)
WORKSPACE_ROOT="./workspace"
```

### API í‚¤ ë°œê¸‰ ë°©ë²•

#### Tavily API
1. https://tavily.com ë°©ë¬¸
2. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
3. API Keys ë©”ë‰´ì—ì„œ í‚¤ ìƒì„±
4. ë¬´ë£Œ í”Œëœ: ì›” 1,000íšŒ ê²€ìƒ‰ ê°€ëŠ¥

#### OpenAI API
1. https://platform.openai.com ë°©ë¬¸
2. API Keys ë©”ë‰´ì—ì„œ í‚¤ ìƒì„±
3. ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ê³¼ê¸ˆ

#### Anthropic API
1. https://console.anthropic.com ë°©ë¬¸
2. API Keys ë©”ë‰´ì—ì„œ í‚¤ ìƒì„±
3. ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ê³¼ê¸ˆ

---

## ğŸš€ 3ë‹¨ê³„: ê¸°ë³¸ ì‹¤í–‰

### ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸

```python
# test_basic.py
import asyncio
from src.separate_agent import run_research
from langchain_community.tools.tavily_search import TavilySearchResults

async def main():
    # ë„êµ¬ ì„¤ì •
    tavily_search = TavilySearchResults(max_results=5)
    
    # ì—°êµ¬ ì‹¤í–‰
    result = await run_research(
        question="AI ìœ¤ë¦¬ì˜ í•µì‹¬ ì›ì¹™ì€ ë¬´ì—‡ì¸ê°€?",
        tools=[tavily_search],
        model="openai:gpt-4",  # ë˜ëŠ” "anthropic:claude-sonnet-4"
        thread_id="test_session_1",
        max_researcher_iterations=5,
        enable_critique=False,
        enable_clarification=False  # í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë¹„í™œì„±í™”
    )
    
    # ê²°ê³¼ ì¶œë ¥
    print("=== ìµœì¢… ë³´ê³ ì„œ ===")
    print(result.get("final_report", "ë³´ê³ ì„œ ìƒì„± ì‹¤íŒ¨"))

if __name__ == "__main__":
    asyncio.run(main())
```

### ì‹¤í–‰

```bash
python test_basic.py
```

---

## âš™ï¸ 4ë‹¨ê³„: ê³ ê¸‰ ì„¤ì •

### ì„¤ì • ì»¤ìŠ¤í„°ë§ˆì´ì§•

```python
from src.configuration import DeepAgentConfiguration, SearchAPI

# ì»¤ìŠ¤í…€ ì„¤ì • ìƒì„±
config = DeepAgentConfiguration(
    # ëª¨ë¸ ì„¤ì •
    main_model="anthropic:claude-sonnet-4",
    researcher_model="openai:gpt-4",  # ì—°êµ¬ìëŠ” ë‹¤ë¥¸ ëª¨ë¸ ì‚¬ìš©
    summarization_model="openai:gpt-4-turbo",
    
    # ê²€ìƒ‰ ì„¤ì •
    search_api=SearchAPI.TAVILY,
    max_content_length=50000,
    
    # DeepAgent ì„¤ì •
    max_parallel_researchers=3,  # ë™ì‹œ ì—°êµ¬ì ìˆ˜
    max_researcher_iterations=10,  # ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜
    enable_critique_phase=True,  # í’ˆì§ˆ ê²€ì¦ í™œì„±í™”
    compression_threshold_tokens=150000,
    
    # ë°±ì—”ë“œ ì„¤ì •
    use_persistent_backend=True,
    workspace_root="./workspace"
)

# ì„¤ì •ì„ ëŸ°íƒ€ì„ configë¡œ ë³€í™˜
runnable_config = config.to_runnable_config()
```

### ì²´í¬í¬ì¸í„° ì„¤ì • (ìƒíƒœ ì˜ì†í™”)

```python
from langgraph.checkpoint.sqlite import SqliteSaver

# SQLite ì²´í¬í¬ì¸í„° (ì˜êµ¬ ì €ì¥)
checkpointer = SqliteSaver.from_conn_string("checkpoints.db")

# ì—°êµ¬ ì‹¤í–‰
result = await run_research(
    question="AI ìœ¤ë¦¬ ì—°êµ¬",
    tools=[tavily_search],
    checkpointer=checkpointer,  # ì²´í¬í¬ì¸í„° ì „ë‹¬
    thread_id="persistent_session_1"
)

# ë‚˜ì¤‘ì— ê°™ì€ thread_idë¡œ ì¬ê°œ ê°€ëŠ¥
result2 = await run_research(
    question="ì¶”ê°€ ì§ˆë¬¸",
    tools=[tavily_search],
    checkpointer=checkpointer,
    thread_id="persistent_session_1"  # ì´ì „ ìƒíƒœ ì´ì–´ì„œ ì§„í–‰
)
```

---

## ğŸ“ 5ë‹¨ê³„: íŒŒì¼ì‹œìŠ¤í…œ ë°±ì—”ë“œ í™œìš©

### ì‘ì—… ê³µê°„ êµ¬ì¡°

```
workspace/
â””â”€â”€ main_agent/
    â”œâ”€â”€ research_brief.md          # ì—°êµ¬ ê³„íš
    â”œâ”€â”€ output/
    â”‚   â”œâ”€â”€ notes/                 # ì—°êµ¬ìë“¤ì˜ ë…¸íŠ¸
    â”‚   â”‚   â”œâ”€â”€ topic1.md
    â”‚   â”‚   â”œâ”€â”€ topic2.md
    â”‚   â”‚   â””â”€â”€ topic3.md
    â”‚   â”œâ”€â”€ compressed_research.md # ì••ì¶•ëœ ì—°êµ¬
    â”‚   â””â”€â”€ final_report.md        # ìµœì¢… ë³´ê³ ì„œ
    â”œâ”€â”€ feedback.md                # ë¹„í‰ê°€ í”¼ë“œë°± (ì„ íƒ)
    â””â”€â”€ status/
        â”œâ”€â”€ current_stage.txt      # í˜„ì¬ ë‹¨ê³„
        â””â”€â”€ context_mode.txt       # ì»¨í…ìŠ¤íŠ¸ ëª¨ë“œ
```

### ê²°ê³¼ íŒŒì¼ ì½ê¸°

```python
import os

# ì‘ì—… ê³µê°„ ê²½ë¡œ
workspace = "./workspace/main_agent"

# ìµœì¢… ë³´ê³ ì„œ ì½ê¸°
with open(f"{workspace}/output/final_report.md", "r") as f:
    final_report = f.read()
    print(final_report)

# ì••ì¶•ëœ ì—°êµ¬ ì½ê¸°
with open(f"{workspace}/output/compressed_research.md", "r") as f:
    compressed = f.read()
    print(compressed)

# ê°œë³„ ë…¸íŠ¸ ì½ê¸°
notes_dir = f"{workspace}/output/notes"
for filename in os.listdir(notes_dir):
    if filename.endswith(".md"):
        with open(f"{notes_dir}/{filename}", "r") as f:
            print(f"=== {filename} ===")
            print(f.read())
```

---

## ğŸ›ï¸ 6ë‹¨ê³„: ì‹¤í–‰ ì˜µì…˜

### ì˜µì…˜ 1: ëª…í™•í™” ë‹¨ê³„ í¬í•¨

```python
result = await run_research(
    question="AIì— ëŒ€í•´ ì•Œë ¤ì¤˜",  # ëª¨í˜¸í•œ ì§ˆë¬¸
    tools=[tavily_search],
    enable_clarification=True  # ëª…í™•í™” í™œì„±í™”
)

# ì²« ë²ˆì§¸ ì‘ë‹µ: ëª…í™•í™” ì§ˆë¬¸
print(result["messages"][-1].content)
# "AIì˜ ì–´ë–¤ ì¸¡ë©´ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?"

# ì‚¬ìš©ì ì‘ë‹µ í›„ ì¬ì‹¤í–‰
result = await run_research(
    question="AI ìœ¤ë¦¬ì— ëŒ€í•´ ì•Œë ¤ì¤˜",
    tools=[tavily_search],
    thread_id="same_session",  # ê°™ì€ ì„¸ì…˜
    enable_clarification=True
)
```

### ì˜µì…˜ 2: í’ˆì§ˆ ê²€ì¦ í¬í•¨

```python
result = await run_research(
    question="AI ìœ¤ë¦¬ ì—°êµ¬",
    tools=[tavily_search],
    enable_critique=True  # ë¹„í‰ê°€ í™œì„±í™”
)

# í”¼ë“œë°± í™•ì¸
feedback_path = "./workspace/main_agent/feedback.md"
if os.path.exists(feedback_path):
    with open(feedback_path, "r") as f:
        print("=== í’ˆì§ˆ ê²€ì¦ í”¼ë“œë°± ===")
        print(f.read())
```

### ì˜µì…˜ 3: ë³‘ë ¬ ì—°êµ¬ì ìˆ˜ ì¡°ì •

```python
# ë¹ ë¥¸ ì—°êµ¬ (ì—°êµ¬ì 1ëª…)
result = await run_research(
    question="ê°„ë‹¨í•œ ì§ˆë¬¸",
    tools=[tavily_search],
    max_researcher_iterations=3
)

# ì‹¬ì¸µ ì—°êµ¬ (ì—°êµ¬ì 5ëª…)
result = await run_research(
    question="ë³µì¡í•œ ì§ˆë¬¸",
    tools=[tavily_search],
    max_researcher_iterations=10
)
```

---

## ğŸ› 7ë‹¨ê³„: ë””ë²„ê¹…

### ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”

```python
from src.separate_agent import create_deep_research_agent

# ì—ì´ì „íŠ¸ ìƒì„± ì‹œ debug=True
agent = await create_deep_research_agent(
    tools=[tavily_search],
    model="openai:gpt-4",
    # debug=TrueëŠ” create_deep_agent ë‚´ë¶€ì—ì„œ ì´ë¯¸ ì„¤ì •ë¨
)

# ì‹¤í–‰ ì‹œ ìƒì„¸ ë¡œê·¸ ì¶œë ¥
result = await agent.ainvoke(
    {"messages": [{"role": "user", "content": "AI ìœ¤ë¦¬"}]},
    config={
        "configurable": {"thread_id": "debug_session"},
        "recursion_limit": 100
    }
)
```

### ìƒíƒœ í™•ì¸

```python
# ì¤‘ê°„ ìƒíƒœ í™•ì¸
print("=== í˜„ì¬ ìƒíƒœ ===")
print(f"ì—°êµ¬ ë°˜ë³µ íšŸìˆ˜: {result.get('research_iterations', 0)}")
print(f"ìˆ˜ì§‘ëœ ë…¸íŠ¸ ìˆ˜: {len(result.get('raw_notes', []))}")
print(f"ì••ì¶•ëœ ë…¸íŠ¸ ìˆ˜: {len(result.get('notes', []))}")
print(f"ìµœì¢… ë³´ê³ ì„œ ê¸¸ì´: {len(result.get('final_report', ''))}")
```

### ë¡œê·¸ íŒŒì¼ í™•ì¸

```python
import logging

# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('deep_research.log'),
        logging.StreamHandler()
    ]
)

# ì‹¤í–‰ í›„ ë¡œê·¸ íŒŒì¼ í™•ì¸
# deep_research.log íŒŒì¼ì— ëª¨ë“  ë¡œê·¸ ê¸°ë¡ë¨
```

---

## ğŸ“Š 8ë‹¨ê³„: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ì‹¤í–‰ ì‹œê°„ ì¸¡ì •

```python
import time

start_time = time.time()

result = await run_research(
    question="AI ìœ¤ë¦¬ ì—°êµ¬",
    tools=[tavily_search]
)

end_time = time.time()
elapsed_time = end_time - start_time

print(f"ì´ ì‹¤í–‰ ì‹œê°„: {elapsed_time:.2f}ì´ˆ")
print(f"ì—°êµ¬ ë°˜ë³µ íšŸìˆ˜: {result.get('research_iterations', 0)}")
print(f"í‰ê·  ë°˜ë³µ ì‹œê°„: {elapsed_time / max(result.get('research_iterations', 1), 1):.2f}ì´ˆ")
```

### í† í° ì‚¬ìš©ëŸ‰ ì¶”ì 

```python
# LangSmith ë˜ëŠ” LangFuse ì‚¬ìš© (ì„ íƒ)
# .envì— ì¶”ê°€:
# LANGCHAIN_TRACING_V2=true
# LANGCHAIN_API_KEY=your-langsmith-key

# ì‹¤í–‰ í›„ LangSmith ëŒ€ì‹œë³´ë“œì—ì„œ í† í° ì‚¬ìš©ëŸ‰ í™•ì¸
```

---

## ğŸ”§ 9ë‹¨ê³„: ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ì˜¤ë¥˜

#### 1. API í‚¤ ì˜¤ë¥˜
```
Error: Invalid API key
```
**í•´ê²°**: `.env` íŒŒì¼ì˜ API í‚¤ í™•ì¸

#### 2. ëª¨ë“ˆ ì—†ìŒ ì˜¤ë¥˜
```
ModuleNotFoundError: No module named 'deepagents'
```
**í•´ê²°**: 
```bash
pip install deepagents
```

#### 3. íŒŒì¼ ê¶Œí•œ ì˜¤ë¥˜
```
PermissionError: [Errno 13] Permission denied: './workspace'
```
**í•´ê²°**:
```bash
chmod -R 755 ./workspace
```

#### 4. ë©”ëª¨ë¦¬ ë¶€ì¡±
```
MemoryError
```
**í•´ê²°**: `max_content_length` ì¤„ì´ê¸°
```python
config = DeepAgentConfiguration(
    max_content_length=10000  # ê¸°ë³¸ê°’ 50000ì—ì„œ ì¤„ì„
)
```

#### 5. íƒ€ì„ì•„ì›ƒ
```
TimeoutError
```
**í•´ê²°**: `recursion_limit` ëŠ˜ë¦¬ê¸°
```python
config = {
    "recursion_limit": 200  # ê¸°ë³¸ê°’ 100ì—ì„œ ëŠ˜ë¦¼
}
```

---

## ğŸ“ 10ë‹¨ê³„: ì‹¤ì „ ì˜ˆì œ

### ì˜ˆì œ 1: ê°„ë‹¨í•œ ì—°êµ¬

```python
import asyncio
from src.separate_agent import run_research
from langchain_community.tools.tavily_search import TavilySearchResults

async def simple_research():
    tavily = TavilySearchResults(max_results=3)
    
    result = await run_research(
        question="GPT-4ì˜ ì£¼ìš” íŠ¹ì§•ì€?",
        tools=[tavily],
        model="openai:gpt-4",
        max_researcher_iterations=3,
        enable_critique=False,
        enable_clarification=False
    )
    
    print(result["final_report"])

asyncio.run(simple_research())
```

### ì˜ˆì œ 2: ì‹¬ì¸µ ì—°êµ¬ (í’ˆì§ˆ ê²€ì¦ í¬í•¨)

```python
async def deep_research():
    tavily = TavilySearchResults(max_results=5)
    
    result = await run_research(
        question="AI ìœ¤ë¦¬ì˜ í˜„í™©ê³¼ ê³¼ì œë¥¼ ì‹¬ì¸µ ë¶„ì„í•´ì£¼ì„¸ìš”",
        tools=[tavily],
        model="anthropic:claude-sonnet-4",
        max_researcher_iterations=10,
        enable_critique=True,  # í’ˆì§ˆ ê²€ì¦ í™œì„±í™”
        enable_clarification=True
    )
    
    # ìµœì¢… ë³´ê³ ì„œ
    print("=== ìµœì¢… ë³´ê³ ì„œ ===")
    print(result["final_report"])
    
    # í”¼ë“œë°± (ìˆëŠ” ê²½ìš°)
    feedback_path = "./workspace/main_agent/feedback.md"
    if os.path.exists(feedback_path):
        with open(feedback_path, "r") as f:
            print("\n=== í’ˆì§ˆ ê²€ì¦ í”¼ë“œë°± ===")
            print(f.read())

asyncio.run(deep_research())
```

### ì˜ˆì œ 3: ì„¸ì…˜ ì¬ê°œ

```python
from langgraph.checkpoint.sqlite import SqliteSaver

async def resumable_research():
    checkpointer = SqliteSaver.from_conn_string("sessions.db")
    tavily = TavilySearchResults(max_results=5)
    
    # ì²« ë²ˆì§¸ ì„¸ì…˜
    result1 = await run_research(
        question="AI ìœ¤ë¦¬ì— ëŒ€í•´ ì—°êµ¬í•´ì¤˜",
        tools=[tavily],
        thread_id="session_123",
        checkpointer=checkpointer
    )
    
    print("ì²« ë²ˆì§¸ ì—°êµ¬ ì™„ë£Œ")
    
    # ë‚˜ì¤‘ì— ê°™ì€ ì„¸ì…˜ ì¬ê°œ
    result2 = await run_research(
        question="ì¶”ê°€ë¡œ ê·œì œ ë™í–¥ë„ ì¡°ì‚¬í•´ì¤˜",
        tools=[tavily],
        thread_id="session_123",  # ê°™ì€ ID
        checkpointer=checkpointer
    )
    
    print("ì¶”ê°€ ì—°êµ¬ ì™„ë£Œ")

asyncio.run(resumable_research())
```

---

## ğŸ¯ í•µì‹¬ ìš”ì•½

1. **í™˜ê²½ ì„¤ì •**: Python 3.10+, í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
2. **API í‚¤**: `.env` íŒŒì¼ì— Tavily, OpenAI/Anthropic í‚¤ ì„¤ì •
3. **ê¸°ë³¸ ì‹¤í–‰**: `run_research()` í•¨ìˆ˜ ì‚¬ìš©
4. **ê³ ê¸‰ ì„¤ì •**: `DeepAgentConfiguration`ìœ¼ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
5. **íŒŒì¼ í™•ì¸**: `workspace/main_agent/output/` ë””ë ‰í† ë¦¬
6. **ë””ë²„ê¹…**: ë¡œê·¸ í™œì„±í™”, ìƒíƒœ í™•ì¸
7. **ë¬¸ì œ í•´ê²°**: ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ëŒ€ì‘ ë°©ë²•

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

ì‹¤í–‰ ë°©ë²•ì„ ìµí˜”ë‹¤ë©´, **06_FAQ.md**ì—ì„œ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í™•ì¸í•˜ì„¸ìš”!
